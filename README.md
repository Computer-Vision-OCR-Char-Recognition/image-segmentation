# Image segmentation

Image segmentation web service designed for hosting on Heroku.

![](https://i.imgur.com/hsiR4hV.jpg)
![](https://segment-image.herokuapp.com/http://i.imgur.com/hsiR4hV.jpg?cluster_method=meanshift&quantile=0.015&colour_space=ycrcb)

The API is inspired by [imgix](http://imgix.com) - you pass in the image url (optionally urlencoded),  control the algorithm with query parameters, and recieve a segmented image as the response (or a JSON formatted error). This allows you to embed it in a web page, or play with the algorithm in your browser without having to install any software.

```bash
https://segment-image.herokuapp.com/<image_url>?cluster_method=kmeans&num_clusters=10
```

The image above on the right is generated by the following URL (open it in your browser and try changing the parameters!):

```
https://segment-image.herokuapp.com/http://i.imgur.com/hsiR4hV.jpg?cluster_method=meanshift&quantile=0.015&colour_space=ycrcb
```

The service supports the following parameters:

| Parameter | Description |
|---|---|
| `cluster_method` | `ward`, `meanshift` or `kmeans` |
| `colour_space` | `rgb`, `hsv`, `hls`, `ycrcb`, `lab` or `luv` |
| `num_clusters` | integer between 1 and 100, e.g. 5 (required with ward and kmeans) |
| `quantile` | a float between 0 and 1, e.g. 0.01 (required with meanshift) |

Ward is interesting, because it's configured with connectivity constraints - it'll cluster colours together by region. It's also the slowest algorithm, so may timeout (after ~25 seconds).

### Deployment

[![Deploy](https://www.herokucdn.com/deploy/button.svg)](https://heroku.com/deploy)

### Notes

Configure Redis to evict the less recently used keys first:

```
heroku redis:maxmemory --policy allkeys-lru
```

---

## Gallery

![](http://i.imgur.com/ktOiD80.jpg)
![](http://segment-image.herokuapp.com/http://i.imgur.com/ktOiD80.jpg?cluster_method=meanshift&quantile=0.1&colour_space=luv)

---

<img src="https://github.com/alexlouden/image-segmentation/raw/master/examples/golden.jpg" width="400"/>

| Method | Meanshift `quantile=0.07` | Meanshift `quantile=0.15` |
|---|---|---|
| RGB | <img src="http://segment-image.herokuapp.com/https://github.com/alexlouden/image-segmentation/raw/master/examples/golden.jpg?cluster_method=meanshift&quantile=0.07&colour_space=rgb"> | <img src="http://segment-image.herokuapp.com/https://github.com/alexlouden/image-segmentation/raw/master/examples/golden.jpg?cluster_method=meanshift&quantile=0.15&colour_space=rgb"> |
| HSV | <img src="http://segment-image.herokuapp.com/https://github.com/alexlouden/image-segmentation/raw/master/examples/golden.jpg?cluster_method=meanshift&quantile=0.07&colour_space=hsv"> | <img src="http://segment-image.herokuapp.com/https://github.com/alexlouden/image-segmentation/raw/master/examples/golden.jpg?cluster_method=meanshift&quantile=0.15&colour_space=hsv"> |
| HLS | <img src="http://segment-image.herokuapp.com/https://github.com/alexlouden/image-segmentation/raw/master/examples/golden.jpg?cluster_method=meanshift&quantile=0.07&colour_space=hls"> | <img src="http://segment-image.herokuapp.com/https://github.com/alexlouden/image-segmentation/raw/master/examples/golden.jpg?cluster_method=meanshift&quantile=0.15&colour_space=hls"> |
| YCrCb | <img src="http://segment-image.herokuapp.com/https://github.com/alexlouden/image-segmentation/raw/master/examples/golden.jpg?cluster_method=meanshift&quantile=0.07&colour_space=ycrcb"> | <img src="http://segment-image.herokuapp.com/https://github.com/alexlouden/image-segmentation/raw/master/examples/golden.jpg?cluster_method=meanshift&quantile=0.15&colour_space=ycrcb"> |
| LAB | <img src="http://segment-image.herokuapp.com/https://github.com/alexlouden/image-segmentation/raw/master/examples/golden.jpg?cluster_method=meanshift&quantile=0.07&colour_space=lab"> | <img src="http://segment-image.herokuapp.com/https://github.com/alexlouden/image-segmentation/raw/master/examples/golden.jpg?cluster_method=meanshift&quantile=0.15&colour_space=lab"> |
| LUV | <img src="http://segment-image.herokuapp.com/https://github.com/alexlouden/image-segmentation/raw/master/examples/golden.jpg?cluster_method=meanshift&quantile=0.07&colour_space=luv"> | <img src="http://segment-image.herokuapp.com/https://github.com/alexlouden/image-segmentation/raw/master/examples/golden.jpg?cluster_method=meanshift&quantile=0.15&colour_space=luv"> |

| Method | K-Means `num_clusters=4` | K-means `num_clusters=8` |
|---|---|---|
| RGB | <img src="http://segment-image.herokuapp.com/https://github.com/alexlouden/image-segmentation/raw/master/examples/golden.jpg?cluster_method=kmeans&num_clusters=4&colour_space=rgb"> | <img src="http://segment-image.herokuapp.com/https://github.com/alexlouden/image-segmentation/raw/master/examples/golden.jpg?cluster_method=kmeans&num_clusters=8&colour_space=rgb"> |
| HSV | <img src="http://segment-image.herokuapp.com/https://github.com/alexlouden/image-segmentation/raw/master/examples/golden.jpg?cluster_method=kmeans&num_clusters=4&colour_space=hsv"> | <img src="http://segment-image.herokuapp.com/https://github.com/alexlouden/image-segmentation/raw/master/examples/golden.jpg?cluster_method=kmeans&num_clusters=8&colour_space=hsv"> |
| HLS | <img src="http://segment-image.herokuapp.com/https://github.com/alexlouden/image-segmentation/raw/master/examples/golden.jpg?cluster_method=kmeans&num_clusters=4&colour_space=hls"> | <img src="http://segment-image.herokuapp.com/https://github.com/alexlouden/image-segmentation/raw/master/examples/golden.jpg?cluster_method=kmeans&num_clusters=8&colour_space=hls"> |
| YCrCb | <img src="http://segment-image.herokuapp.com/https://github.com/alexlouden/image-segmentation/raw/master/examples/golden.jpg?cluster_method=kmeans&num_clusters=4&colour_space=ycrcb"> | <img src="http://segment-image.herokuapp.com/https://github.com/alexlouden/image-segmentation/raw/master/examples/golden.jpg?cluster_method=kmeans&num_clusters=8&colour_space=ycrcb"> |
| LAB | <img src="http://segment-image.herokuapp.com/https://github.com/alexlouden/image-segmentation/raw/master/examples/golden.jpg?cluster_method=kmeans&num_clusters=4&colour_space=lab"> | <img src="http://segment-image.herokuapp.com/https://github.com/alexlouden/image-segmentation/raw/master/examples/golden.jpg?cluster_method=kmeans&num_clusters=8&colour_space=lab"> |
| LUV | <img src="http://segment-image.herokuapp.com/https://github.com/alexlouden/image-segmentation/raw/master/examples/golden.jpg?cluster_method=kmeans&num_clusters=4&colour_space=luv"> | <img src="http://segment-image.herokuapp.com/https://github.com/alexlouden/image-segmentation/raw/master/examples/golden.jpg?cluster_method=kmeans&num_clusters=8&colour_space=luv"> |

| Method | Ward `num_clusters=6` | Ward `num_clusters=15` |
|---|---|---|
| RGB | <img src="http://segment-image.herokuapp.com/https://github.com/alexlouden/image-segmentation/raw/master/examples/golden.jpg?cluster_method=ward&num_clusters=6&colour_space=rgb"> | <img src="http://segment-image.herokuapp.com/https://github.com/alexlouden/image-segmentation/raw/master/examples/golden.jpg?cluster_method=ward&num_clusters=15&colour_space=rgb"> |
| HSV | <img src="http://segment-image.herokuapp.com/https://github.com/alexlouden/image-segmentation/raw/master/examples/golden.jpg?cluster_method=ward&num_clusters=6&colour_space=hsv"> | <img src="http://segment-image.herokuapp.com/https://github.com/alexlouden/image-segmentation/raw/master/examples/golden.jpg?cluster_method=ward&num_clusters=15&colour_space=hsv"> |
| HLS | <img src="http://segment-image.herokuapp.com/https://github.com/alexlouden/image-segmentation/raw/master/examples/golden.jpg?cluster_method=ward&num_clusters=6&colour_space=hls"> | <img src="http://segment-image.herokuapp.com/https://github.com/alexlouden/image-segmentation/raw/master/examples/golden.jpg?cluster_method=ward&num_clusters=15&colour_space=hls"> |
| YCrCb | <img src="http://segment-image.herokuapp.com/https://github.com/alexlouden/image-segmentation/raw/master/examples/golden.jpg?cluster_method=ward&num_clusters=6&colour_space=ycrcb"> | <img src="http://segment-image.herokuapp.com/https://github.com/alexlouden/image-segmentation/raw/master/examples/golden.jpg?cluster_method=ward&num_clusters=15&colour_space=ycrcb"> |
| LAB | <img src="http://segment-image.herokuapp.com/https://github.com/alexlouden/image-segmentation/raw/master/examples/golden.jpg?cluster_method=ward&num_clusters=6&colour_space=lab"> | <img src="http://segment-image.herokuapp.com/https://github.com/alexlouden/image-segmentation/raw/master/examples/golden.jpg?cluster_method=ward&num_clusters=15&colour_space=lab"> |
| LUV | <img src="http://segment-image.herokuapp.com/https://github.com/alexlouden/image-segmentation/raw/master/examples/golden.jpg?cluster_method=ward&num_clusters=6&colour_space=luv"> | <img src="http://segment-image.herokuapp.com/https://github.com/alexlouden/image-segmentation/raw/master/examples/golden.jpg?cluster_method=ward&num_clusters=15&colour_space=luv"> |
